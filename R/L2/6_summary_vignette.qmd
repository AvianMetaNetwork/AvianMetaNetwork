---
title: "Summary Vignette"
format: 
  html: 
    self-contained: true
editor: visual
---

# Interaction Data Summary Statistics

```{r, warnings=FALSE, message=FALSE}

library(dplyr)
set.seed(44)
df <- read.csv(here::here("../Avian-Interaction-Database-Working/L1/ain_cac.csv"))
spp <- read.csv(here::here("./data/L1/species_checklists/spp_joint_cac_colsubset.csv"))

num_intxns <- nrow(df)

unique_intxns <- df %>% 
  dplyr::select(taxa1_scientific, 
                taxa2_scientific, 
                effect_tx1_on_tx2, 
                effect_tx2_on_tx1, 
                interaction) %>% 
  filter(!duplicated(.)) 



unique_pairs <- unique_intxns %>%
  mutate(
    # Labels taxa pairs by alphabetical order 
    taxa_lo = pmin(taxa1_scientific, taxa2_scientific),
    taxa_hi = pmax(taxa1_scientific, taxa2_scientific),

    # Checks whether order is swapped (non-alphabetical) 
    swapped = taxa1_scientific > taxa2_scientific,

    # normalize effects so they always mean:
    # eff_lo_on_hi = effect of taxa_lo on taxa_hi
    # eff_hi_on_lo = effect of taxa_hi on taxa_lo
    eff_lo_on_hi = if_else(swapped, effect_tx2_on_tx1, effect_tx1_on_tx2),
    eff_hi_on_lo = if_else(swapped, effect_tx1_on_tx2, effect_tx2_on_tx1)
  )  %>%
  distinct(taxa_lo, taxa_hi, interaction, eff_lo_on_hi, eff_hi_on_lo)

unique_taxa_list <- unique(c(df$taxa1_scientific, df$taxa2_scientific))
num_total_taxa <- length(unique_taxa_list)

total_cac_taxa1 <- unique(df$taxa1_scientific[df$taxa1_scientific %in% spp$scientific_name_clements2024])
total_cac_taxa2 <- unique(df$taxa2_scientific[df$taxa2_scientific %in% spp$scientific_name_clements2024])
total_cac_taxa <- unique(c(total_cac_taxa1, total_cac_taxa2))

num_non_cac_taxa <-num_total_taxa - length(total_cac_taxa)

unique_spp_list_names <- unique(spp$scientific_name_clements2024)
unique_spp1_ain_names <- unique(df$taxa1_scientific)
```

-   Number of documented pairwise interactions: `r num_intxns`
-   Number of unique pairwise interactions: `r nrow(unique_pairs)`
-   Number of focal taxa: `r total_cac_spp`
-   Number of additional non-focal spp: `r num_non_cac_taxa`
-   Number of species (total): `r num_total_taxa`
-   Percent of world's bird spp (out of 11,1145 spp): **NEED TO GO TO SPP LEVEL**`r round(num_total_taxa/11145*100, 2)`
-   Total number of migratory species: \[Not sure how to calculate this\]
-   Total number of interaction types: `r length(unique(df$interaction))`

### Species list summary

-   Total number of species in the North American Avian Interaction Species List: `r length(unique(spp$scientific_name_clements2024))`

```{r}

unique_intxns %>% group_by(interaction) %>% summarize(n=n()) %>% arrange(-n)
```

# Interaction Data Exploratory Figures

Source `_figure_processing.R` which contains the data processing and plotting functions. See `5.5_figure_processing_vignette.qmd` for further explanation of the data processing and plot functions!

```{r, warning=FALSE, message=FALSE}
source(here::here("../Avian-Interaction-Database/R/L2/_figure_processing.R"))

```

### Interaction Distribution Figure

```{r, fig.width=14, out.width="100%"}
ggplot(type_summ, aes(x = interaction, y = n, fill = interaction)) +
    theme_light() +
    geom_bar(stat = "identity") +
    scale_fill_manual(values = setNames(interaction_categories$color,
                                        interaction_categories$interaction)) +
    geom_text(aes(label = n), hjust = -0.2, size = 4.25) +
    theme(axis.text.x = element_text(angle = 0, size = 14),  
          axis.text.y = element_text(size = 14),             
          axis.title = element_text(size = 16),              
          plot.title = element_text(size = 18),              
          legend.position = "none") +
    xlab("") +
    ylab("") +
    labs(title = "Total Interactions Records(by entry) in North America") +
    coord_flip()
```

```{r, fig.width=14, out.width="100%"}
ggplot(type_summ_slim, aes(x = interaction, y = n, fill = interaction)) +
    theme_light() +
    geom_bar(stat = "identity") +
    scale_fill_manual(values = setNames(interaction_categories$color,
                                        interaction_categories$interaction)) +
    geom_text(aes(label = n), hjust = -0.2, size = 4.25) +
    theme(axis.text.x = element_text(angle = 0, size = 14),  
          axis.text.y = element_text(size = 14),             
          axis.title = element_text(size = 16),              
          plot.title = element_text(size = 18),              
          legend.position = "none") +
    xlab("") +
    ylab("") +
    labs(title = "Total Interaction Records (by unique species and type) in North America") +
    coord_flip()
```

### Interaction Phylogeny Figure

```{r, fig.width=16, fig.height=8, out.width="100%"}
#| warning: false

phyloplot_species <- plot_phylo_combined(
  tree = NA_tree,
  data = inter_NA_working,
  value_col = "n_int",
  label_offset = 8,
  label_size = 4.5,
  tip_size = 2,
  min_species = 25,
  legend_title = "Number of interactions"
)
phyloplot_species
```

### Interaction Network Figure

```{r, fig.width=14, fig.height=6, out.width="100%"}
create_network(inter_NA_int, "Baeolophus inornatus", curve_edges = T, show_labels = F, cats = T)


```

```{r, message=F, fig.width=20, fig.height=15, out.width="100%"}
create_combined_network(inter_NA_int, c("Baeolophus inornatus", "Dryobates nuttallii", "Glaucidium gnoma"), curve_edges = T, cats = F)

```

```{r, message=F, fig.width=20, fig.height=15, out.width="100%"}
create_combined_network(inter_NA_int, c("Baeolophus inornatus", "Dryobates nuttallii", "Glaucidium gnoma"), curve_edges = T, cats = T, legend_text_size = 35, legend_line_size = 5)
```
